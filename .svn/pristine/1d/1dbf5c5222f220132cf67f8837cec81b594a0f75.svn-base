webpackJsonp([12],{xwhl:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=r("Dd8w"),o=r.n(s),i=r("+oYz"),n=r("NYxO"),a={data:function(){var e=this;return{rules1:{mobile:[{required:!0,validator:function(t,r,s){return r?/^1([38][0-9]|4[579]|5[0-3,5-9]|6[6]|7[0135678]|9[89])\d{8}$/.test(r)?void Object(i.b)({mobile:r}).then(function(t){if(0===t.data.data.list.length)s();else if(t.data.data.list.length>0)if(e.userInfo=t.data.data.list[0],"QQ"===e.thirdUser.loginType){if(e.userInfo.qqId)return s(new Error("该手机号已绑定其他QQ"));s()}else if("PCW"===e.thirdUser.loginType){if(e.userInfo.wxid)return s(new Error("该手机号已绑定其他微信"));s()}else if("WB"===e.thirdUser.loginType){if(e.userInfo.wbId)return s(new Error("该手机号已绑定其他微博"));s()}}):s(new Error("手机号不合法")):s(new Error("账号不能为空"))},trigger:"blur"}]},form1:{},rules2:{pwd:[{required:!0,validator:function(t,r,s){""===r?s(new Error("请输入密码")):(new RegExp("(?=.*[0-9])(?=.*[a-zA-Z]).{8,30}").test(r)?""!==e.form2.checkPass&&e.$refs.ruleForm2.validateField("checkPass"):s(new Error("密码不合法（必须包含字母、数字且不少于8位）")),s())},trigger:"blur"}],checkPass:[{required:!0,validator:function(t,r,s){""===r?s(new Error("请再次输入密码")):r!==e.form2.pwd?s(new Error("两次输入密码不一致!")):s()},trigger:"blur"}]},form2:{},success:!1,seconds:120,step:1,userType:"",userInfo:null}},computed:o()({},Object(n.b)(["thirdUser"])),methods:{toNext:function(){var e=this,t=this;this.$refs.ruleForm.validate(function(r){if(r)if(e.userInfo){var s={};s.id=e.userInfo.id,s.cover=e.thirdUser.cover,"QQ"===e.thirdUser.loginType?s.qqId=e.thirdUser.qqId:"PCW"===e.thirdUser.loginType?s.wxid=e.thirdUser.wxid:"WB"===e.thirdUser.loginType&&(s.wbId=e.thirdUser.wbId),e.$apis.bindMobileUpdate(s).then(function(e){if(100===e.data.status.returnCode){t.$message.success("绑定成功!");var r=window.location.origin;window.location.href=r+"/21pdfcontest/pdf/intro"}})}else e.$apis.checkLoginCode({code:e.form1.verifyCodes}).then(function(e){100===e.data.status.returnCode&&(t.step=2)})})},getCode:function(){var e=this,t=this;this.$refs.ruleForm.validate(function(r){r&&e.$apis.getMsgCode({mobile:e.form1.mobile}).then(function(e){if(100===e.data.status.returnCode){t.success=!0;var r=setInterval(function(){t.seconds--,0===t.seconds&&clearInterval(r)},1e3)}})})},reGetCode:function(){var e=this,t=this;this.$refs.ruleForm.validate(function(r){r&&e.$apis.getMsgCode({mobile:e.form1.mobile}).then(function(e){if(console.log("手机验证",e),100===e.data.status.returnCode){t.seconds=120;var r=setInterval(function(){t.seconds--,0===t.seconds&&clearInterval(r)},1e3)}})})},bindMobile:function(){var e=this;this.$refs.ruleForm2.validate(function(t){if(t){var r={},s=e;r.mobile=e.form1.mobile,r.nickname=e.thirdUser.nickname,r.cover=e.thirdUser.cover,r.gender=e.thirdUser.gender,r.pwd=e.form2.pwd,r.verifyCodes=e.form2.verifyCodes,r.lcCode=e.$store.state.app.setting.lcCode,r.wxid=e.thirdUser.wxid,r.qqId=e.thirdUser.qqId,r.wbId=e.thirdUser.wbId,e.$apis.bindMobile(r).then(function(e){if(100===e.data.status.returnCode){s.$message.success("绑定成功!");var t=window.location.origin;window.location.href=t+"/21pdfcontest/pdf/intro",s.$router.push({name:"pdf_intro"})}})}})}}},d={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"bind-mobile"},[r("div",{staticClass:"kada-container"},[r("div",{staticClass:"bind-body"},[r("div",{staticClass:"header"},[r("img",{directives:[{name:"lazy",rawName:"v-lazy",value:e.thirdUser.cover,expression:"thirdUser.cover"}],attrs:{alt:""}}),e._v(" "),r("p",[e._v(e._s(e.thirdUser.nickname))]),e._v(" "),r("h3",[e._v("注册并绑定手机号码")])]),e._v(" "),1===e.step?r("el-form",{ref:"ruleForm",attrs:{rules:e.rules1,model:e.form1,"label-width":"79px","hide-required-asterisk":""}},[r("el-form-item",{attrs:{label:"手机号码",prop:"mobile"}},[r("el-input",{attrs:{type:"text",autocomplete:"off",maxlength:"11"},model:{value:e.form1.mobile,callback:function(t){e.$set(e.form1,"mobile",t)},expression:"form1.mobile"}})],1),e._v(" "),r("el-form-item",{staticClass:"getcode",attrs:{label:"校验码",prop:"verifyCodes"}},[r("el-input",{attrs:{type:"text",autocomplete:"off"},model:{value:e.form1.verifyCodes,callback:function(t){e.$set(e.form1,"verifyCodes",t)},expression:"form1.verifyCodes"}}),e._v(" "),r("div",{staticClass:"code"},[e.success&&0===e.seconds?r("el-button",{attrs:{type:"primary"},on:{click:e.reGetCode}},[e._v("重新获取")]):e._e(),e._v(" "),e.success?e._e():r("el-button",{attrs:{type:"primary",plain:""},on:{click:e.getCode}},[e._v("获取")]),e._v(" "),r("el-button",{directives:[{name:"show",rawName:"v-show",value:e.success&&e.seconds>0,expression:"success && seconds>0"}],attrs:{type:"info",disabled:"",id:"seconds"}},[e._v(e._s(e.seconds)+"s")])],1)],1),e._v(" "),r("div",{staticClass:"bottom-btn"},[r("el-button",{attrs:{type:"primary"},on:{click:e.toNext}},[e._v("下一步")])],1)],1):e._e(),e._v(" "),2===e.step?r("el-form",{ref:"ruleForm2",attrs:{rules:e.rules2,model:e.form2,"label-width":"79px","hide-required-asterisk":""}},[r("el-form-item",{attrs:{label:"密码",prop:"pwd"}},[r("el-input",{attrs:{type:"text",autocomplete:"off"},model:{value:e.form2.pwd,callback:function(t){e.$set(e.form2,"pwd",t)},expression:"form2.pwd"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"确认密码",prop:"checkPass"}},[r("el-input",{attrs:{type:"password",autocomplete:"off"},model:{value:e.form2.checkPass,callback:function(t){e.$set(e.form2,"checkPass",t)},expression:"form2.checkPass"}})],1),e._v(" "),r("div",{staticClass:"bottom-btn"},[r("el-button",{attrs:{type:"primary"},on:{click:e.bindMobile}},[e._v("注册并绑定")])],1)],1):e._e()],1)])])},staticRenderFns:[]},l=r("VU/8")(a,d,!1,null,null,null);t.default=l.exports}});
//# sourceMappingURL=12.28a04b3d56c2b1da7e77.js.map