webpackJsonp([14],{eCo1:function(e,o,s){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var t=s("Dd8w"),r=s.n(t),i=s("NYxO"),a={computed:r()({},Object(i.b)(["thirdUser","backrouter"])),data:function(){return{show:!1,form:{},seconds:120,success:!1,colorflag:0,pswcolorflag:0,pswcolorflag1:0,codecolorflag:0,codeSrc:"",errormsg:"",step:1,userType:"",userInfo:null,canSendMig:!1}},methods:{toPath:function(e){this.$router.push({path:e})},changecolor:function(e,o){var s=this;if(1===e){if(this.colorflag=o,this.errormsg="",void 0!==this.form.mobile){if(!/^1([38][0-9]|4[579]|5[0-3,5-9]|6[6]|7[0135678]|9[89])\d{8}$/.test(this.form.mobile))return this.errormsg="手机号格式错误！",this.colorflag=2,!1;this.$apis.judgeMobile({mobile:this.form.mobile}).then(function(e){if(s.canSendMig=!0,e.data.data.list.length>0)if(s.userInfo=e.data.data.list[0],"QQ"===s.thirdUser.loginType){if(s.userInfo.qqId)return s.canSendMig=!1,s.colorflag=2,s.errormsg="该手机号已绑定其他QQ",!1}else if("WX"===s.thirdUser.loginType){if(s.userInfo.wxid)return s.canSendMig=!1,s.colorflag=2,s.errormsg="该手机号已绑定其他微信",!1}else if("WB"===s.thirdUser.loginType&&s.userInfo.wbId)return s.canSendMig=!1,s.colorflag=2,s.errormsg="该手机号已绑定其他微博",!1})}}else if(2===e)this.pswcolorflag=o,this.errormsg="";else if(3===e)this.codecolorflag=o,this.errormsg="";else if(4===e&&(this.pswcolorflag1=o,this.errormsg="",0===o&&this.form.pwd!==this.form.checkPwd))return this.errormsg="两次密码不一致!",this.pswcolorflag1=2,!1},toNext:function(){var e=this;if(void 0===this.form.mobile)return this.$toast.fail("手机号不能为空！"),!1;if(void 0===this.form.verifyCodes)return this.$toast.fail("验证码不能为空！"),!1;if(this.userInfo){var o={};o.id=this.userInfo.id,o.verifyCodes=this.form.verifyCodes,o.mobile=this.form.mobile,"QQ"===this.thirdUser.loginType?o.qqId=this.thirdUser.qqId:"WX"===this.thirdUser.loginType?o.wxid=this.thirdUser.wxid:"WB"===this.thirdUser.loginType&&(o.wbId=this.thirdUser.wbId),this.$apis.bindUpdateUserMobile(o).then(function(o){if(100===o.data.status.returnCode){e.$toast.success("绑定成功!"),e.updateUserInfo();var s=window.location.href,t=new RegExp("%2F","g");(s=s.replace(t,"/")).indexOf("?redirect=")>-1?(s=s.split("?redirect=")[1],e.$router.push({path:s})):""!==e.backrouter?e.$router.push({path:e.backrouter}):e.$router.push({name:"index"})}})}else this.$apis.checkLoginCode({code:this.form.verifyCodes}).then(function(o){100===o.data.status.returnCode&&(e.step=2)})},bindMobile:function(){var e={},o=this;if(void 0===this.form.pwd)return console.log("密码不能为空！"),void this.$toast.fail("密码不能为空！");void 0!==this.form.checkPwd?new RegExp("(?=.*[0-9])(?=.*[a-zA-Z]).{8,30}").test(this.form.pwd)?(e.mobile=this.form.mobile,e.nickname=this.thirdUser.nickname,e.cover=this.thirdUser.cover,e.gender=this.thirdUser.gender,e.pwd=this.form.pwd,e.verifyCodes=this.form.verifyCodes,e.lcCode=window.localStorage.getItem("lcCode"),e.wxid=this.thirdUser.wxid,e.qqId=this.thirdUser.qqId,e.wbId=this.thirdUser.wbId,this.$apis.bindMobile(e).then(function(e){100===e.data.status.returnCode&&(o.$toast.success("绑定成功!"),o.updateUserInfo(function(){var e=window.location.href,s=new RegExp("%2F","g");(e=e.replace(s,"/")).indexOf("?redirect=")>-1?(e=e.split("?redirect=")[1],o.$router.push({path:e})):""!==o.backrouter?o.$router.push({path:o.backrouter}):o.$router.push({name:"index"})}))})):this.$toast.fail("密码不合法（必须包含字母、数字且不少于8位）!"):this.$toast.fail("请再次输入密码！")},getCode:function(){var e=this;if(!this.form.mobile||!this.canSendMig)return!!this.canSendMig&&(this.$toast.fail("请填写手机号"),!1);this.$apis.getMsgCode({mobile:this.form.mobile}).then(function(o){if(100===o.data.status.returnCode){e.success=!0;var s=setInterval(function(){e.seconds--,0===e.seconds&&clearInterval(s)},1e3)}})},reGetCode:function(){var e=this;if(!this.form.mobile)return this.$toast.fail("请填写手机号"),!1;this.$apis.getMsgCode({mobile:this.form.mobile}).then(function(o){if(100===o.data.status.returnCode){e.seconds=120;var s=setInterval(function(){e.seconds--,0===e.seconds&&clearInterval(s)},1e3)}})},updateUserInfo:function(e){var o=this;this.$apis.getSession().then(function(e){o.$store.commit("SET_USERINFO",e.data.data.list[0].user)}),e&&e()}},mounted:function(){}},n={render:function(){var e=this,o=e.$createElement,s=e._self._c||o;return s("div",{staticClass:"wx-login-bg"},[s("div",{staticClass:"kada-wx-mobile"},[1===e.step?s("van-field",{class:{"kada-mobile-phonefirst":0==e.colorflag,"kada-mobile-phoneinputfirst":1==e.colorflag,"kada-mobile-phoneerrorfirst":2==e.colorflag},attrs:{clearable:"",placeholder:"请输入手机号"},on:{focus:function(o){return e.changecolor(1,1)},blur:function(o){return e.changecolor(1,0)}},model:{value:e.form.mobile,callback:function(o){e.$set(e.form,"mobile",o)},expression:"form.mobile"}}):e._e(),e._v(" "),1===e.step?s("van-field",{class:{"kada-mobile-code1":0==e.codecolorflag,"kada-mobile-codeinput1":1==e.codecolorflag,"kada-mobile-codeerror1":2==e.codecolorflag},attrs:{clearable:"",placeholder:"验证码"},on:{focus:function(o){return e.changecolor(3,1)},blur:function(o){return e.changecolor(3,0)}},model:{value:e.form.verifyCodes,callback:function(o){e.$set(e.form,"verifyCodes",o)},expression:"form.verifyCodes"}}):e._e(),e._v(" "),e.success||1!==e.step?e._e():s("div",{staticClass:"kada-mobile-codebuttom",on:{click:e.getCode}},[s("p",[e._v("获取")])]),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:e.success&&e.seconds>0&&1===e.step,expression:"success && seconds>0 && step === 1"}],staticClass:"kada-mobile-codewait",attrs:{id:"seconds"}},[s("p",[e._v(e._s(e.seconds)+"S")])]),e._v(" "),e.success&&0===e.seconds&&1===e.step?s("div",{staticClass:"kada-mobile-codebuttom",on:{click:e.reGetCode}},[s("p",[e._v("重新获取")])]):e._e(),e._v(" "),2===e.step?s("van-field",{class:{"kada-mobile-phonefirst":0==e.pswcolorflag,"kada-mobile-phoneinputfirst":1==e.pswcolorflag,"kada-mobile-phoneerrorfirst":2==e.pswcolorflag},attrs:{clearable:"",type:"password",placeholder:"密码至少8位 支持数字/字母组合"},on:{focus:function(o){return e.changecolor(2,1)},blur:function(o){return e.changecolor(2,0)}},model:{value:e.form.pwd,callback:function(o){e.$set(e.form,"pwd",o)},expression:"form.pwd"}}):e._e(),e._v(" "),2===e.step?s("van-field",{class:{"kada-mobile-phone":0==e.pswcolorflag1,"kada-mobile-phoneinput":1==e.pswcolorflag1,"kada-mobile-phoneerror":2==e.pswcolorflag1},attrs:{clearable:"",type:"password",placeholder:"请再次输入密码"},on:{focus:function(o){return e.changecolor(4,1)},blur:function(o){return e.changecolor(4,0)}},model:{value:e.form.checkPwd,callback:function(o){e.$set(e.form,"checkPwd",o)},expression:"form.checkPwd"}}):e._e(),e._v(" "),1===e.step?s("div",{staticClass:"kada-wx-phone"},[s("svg-icon",{attrs:{"icon-class":"phone"}})],1):e._e(),e._v(" "),1===e.step?s("div",{staticClass:"kada-wx-psw"},[s("svg-icon",{attrs:{"icon-class":"vcode"}})],1):e._e(),e._v(" "),2===e.step?s("div",{staticClass:"kada-wx-psw3"},[s("svg-icon",{attrs:{"icon-class":"password"}})],1):e._e(),e._v(" "),2===e.step?s("div",{staticClass:"kada-wx-psw4"},[s("svg-icon",{attrs:{"icon-class":"password"}})],1):e._e(),e._v(" "),s("div",{staticClass:"kada-mobile-tips"},[s("p",[e._v(e._s(e.errormsg))])]),e._v(" "),1===e.step?s("div",{staticClass:"kada-login-in",on:{click:e.toNext}},[s("p",[e._v("下一步")])]):e._e(),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:2===e.step,expression:"step === 2"}],staticClass:"kada-login-in",on:{click:e.bindMobile}},[s("p",[e._v("完成")])])],1)])},staticRenderFns:[]},c=s("VU/8")(a,n,!1,null,null,null);o.default=c.exports}});
//# sourceMappingURL=14.ea01c982431db0d05b75.js.map